---
- name: Configure HTPasswd identity provider in OpenShift
  hosts: localhost
  tasks:
    - name: Create HTPasswd file
      shell: |
        htpasswd -c -B -b /tmp/htpasswd {{ htpasswd_username }} {{ htpasswd_password }}
      register: htpasswd_output
      vars:
        htpasswd_username: "testuser"  # Username for HTPasswd
        htpasswd_password: "testpass"  # Password for HTPasswd
      delegate_to: 10.76.107.101
    - name: creating the oauth file
      
    - name: login to ocp
      shell: | 
               oc login -u kubeadmin -p SCkff-wqao2-fbP2U-ScxS2 https://api.nareshp.lab.psi.pnq2.redhat.com:6443 --insecure-skip-tls-verify=true 
               oc create secret generic htpass-secret --from-file=htpasswd=/tmp/htpasswd -n openshift-config
      delegate_to: 10.76.107.101
#    - name: Create secret from HTPasswd file
#      shell: oc create secret generic htpass-secret --from-file=htpasswd=/tmp/htpasswd -n openshift-config
#      args:
#        executable: /bin/bash
#      delegate_to: 10.76.107.101

    - name: Configure OAuth identity provider
      redhat.openshift.k8s:
        kubeconfig: "{{ kubeconfig_path }}"
        state: present
        src: oauth_identity_provider.yml  # Path to your OAuth identity provider YAML file
        force: yes
